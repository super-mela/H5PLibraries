"use strict";(self.webpackChunkh5peditor_portfolio=self.webpackChunkh5peditor_portfolio||[]).push([[987],{5316:function(t,e,i){var n=i(6492);let s=function(){function t(){}return t.extend=function(){for(let t=1;t<arguments.length;t++)for(let e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&("object"==typeof arguments[0][e]&&"object"==typeof arguments[t][e]?this.extend(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]},t.addMixins=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t.prototype)return;Array.isArray(e)||(e=[e]);const i=t.prototype;e.forEach((t=>{const e=t.prototype;Object.getOwnPropertyNames(e).forEach((t=>{"constructor"!==t&&(Object.getOwnPropertyNames(i).includes(t)||(i[t]=e[t]))}))}))},t.swapDOMElements=function(t,e){const i=t.parentNode,n=e.parentNode;if(!i||!n)return;const s=document.createElement("div"),o=document.createElement("div");i.replaceChild(s,t),n.replaceChild(o,e),i.replaceChild(e,s),n.replaceChild(t,o)},t.doubleClick=function(e,i,n){!e||"function"!=typeof i&&"function"!=typeof n||(isNaN(e.target.count)?e.target.count=1:e.target.count++,setTimeout((()=>{1===e.target.count&&i?.(),2===e.target.count&&n?.(),e.target.count=0}),t.DOUBLE_CLICK_TIME))},t.escapeForRegularExpression=function(t){return"string"!=typeof t?"":t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},t.replaceSubContentIDs=function(e){if(Array.isArray(e))e=e.map((e=>t.replaceSubContentIDs(e)));else if("object"==typeof e&&null!==e){e.library&&e.subContentId&&(e.subContentId=H5P.createUUID());for(let i in e)i=t.replaceSubContentIDs(e[i])}return e},t.purifyHTML=function(t){if("string"!=typeof t)return"";let e=(0,n.decode)(t);const i=document.createElement("div");return i.innerHTML=e,e=i.textContent||i.innerText||"",e},t.wait=async function(t){return new Promise((e=>{setTimeout(e,t)}))},t}();function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}s.DOUBLE_CLICK_TIME=300;let r=function(t){var e,i;function n(){var e;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(e=t.call(this)||this).params=s.extend({options:[]},i),e.options={},e.parent=null,e.baseClass="submenu-popup",e.handleClosed=e.handleClosed.bind(o(e)),e.handleKeyDown=e.handleKeyDown.bind(o(e)),e.dom=document.createElement("div"),e.dom.classList.add(e.baseClass),e.dom.classList.add("display-none");const n=document.createElement("div");n.classList.add(`${e.baseClass}-title`),n.innerText=e.params.dictionary.get("l10n.options"),e.dom.appendChild(n);const a=document.createElement("div");return a.classList.add(`${e.baseClass}-options`),a.setAttribute("role","menu"),e.params.options.forEach((t=>{const i=document.createElement("button");i.classList.add(`${e.baseClass}-option`),i.classList.add(`${e.baseClass}-option-${t.id}`),i.setAttribute("role","menuitem"),i.setAttribute("tabindex","-1"),i.innerText=t.label,i.addEventListener("click",(()=>{t.onClick(e.parent),e.hide(t.keepFocus)})),a.appendChild(i),e.options[t.id]=i})),e.dom.appendChild(a),e}i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var r=n.prototype;return r.getDOM=function(){return this.dom},r.setParent=function(t){this.parent=t},r.toggleOptions=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)this.toggleOption(e,t[e])},r.toggleOption=function(t,e){this.options[t]&&"boolean"==typeof e&&this.options[t].classList.toggle("display-none",!e)},r.show=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.focusId=null;for(const e in t.css||{})this.dom.style[e]=t.css[e];this.dom.classList.remove("display-none"),this.dom.classList.toggle("keyboard",t.keyboardUsed),document.body.addEventListener("click",this.handleClosed),this.visibleOptions=this.getVisibleOptions(),this.focusOption(0),t.keyboardUsed&&this.dom.addEventListener("keydown",this.handleKeyDown),this.trigger("shown")},r.hide=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.dom.classList.add("display-none"),document.body.removeEventListener("click",this.handleClosed),this.dom.removeEventListener("keydown",this.handleKeyDown),this.trigger("hidden",{keepFocus:t})},r.getVisibleOptions=function(){const t=[];for(let e=0;e<this.params.options.length;e++){const i=this.params.options[e].id;this.options[i].classList.contains("display-none")||t.push(this.options[i])}return t},r.focusOption=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;"number"==typeof t&&(t%=this.visibleOptions.length,null===this.focusId?this.focusId=0:this.focusId=(this.focusId+this.visibleOptions.length+t)%this.visibleOptions.length,this.visibleOptions[this.focusId].focus())},r.handleKeyDown=function(t){"ArrowUp"===t.key?(t.preventDefault(),this.focusOption(-1)):"ArrowDown"===t.key?(t.preventDefault(),this.focusOption(1)):("Escape"===t.key||"Tab"===t.key)&&(t.preventDefault(),this.hide())},r.handleClosed=function(){this.hide()},n}(H5P.EventDispatcher),h=function(){function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.params=s.extend({hierarchyLevel:1,hierarchyLevelMax:4},t),this.callbacks=s.extend({onShowChapter:()=>{},onShowMenu:()=>{},onLabelEdited:()=>{},onFocusOut:()=>{},onMouseDown:()=>{},onMouseUp:()=>{},onDragStart:()=>{},onDragEnter:()=>{},onDragLeave:()=>{},onDragEnd:()=>{},onMovedUp:()=>{},onMovedDown:()=>{},onMovedRight:()=>{},onMovedLeft:()=>{},onDelete:()=>{},onEdit:()=>{},onTabNext:()=>{},onTabPrevious:()=>{}},e),this.handleLabelEdited=this.handleLabelEdited.bind(this),this.shown=!0,this.dom=document.createElement("button"),this.dom.classList.add("h5peditor-portfolio-chapter-button"),this.dom.classList.add(`h5peditor-portfolio-chapter-button-level-${this.params.hierarchyLevel}`),this.dom.setAttribute("draggable",!0),this.dom.setAttribute("role","menuitem"),this.dom.setAttribute("tabindex","-1"),this.dom.addEventListener("click",(t=>{t.target!==this.menu&&s.doubleClick(t,(()=>{this.handleSingleClick(t)}),(()=>{this.handleDoubleClick(t)}))})),this.label=document.createElement("div"),this.label.classList.add("h5peditor-portfolio-chapter-button-label"),this.label.innerText=this.params.title,this.dom.appendChild(this.label),this.menu=document.createElement("button"),this.menu.classList.add("h5peditor-portfolio-chapter-button-menu"),this.menu.setAttribute("aria-label",this.params.dictionary.get("a11y.openSubmenu")),this.menu.addEventListener("click",(t=>{this.handleClickMenu(t)})),this.dom.appendChild(this.menu),this.dragPlaceholder=document.createElement("div"),this.dragPlaceholder.classList.add("h5peditor-portfolio-chapter-button-placeholder"),this.dragPlaceholder.addEventListener("dragover",(t=>{t.preventDefault()})),this.dragPlaceholder.addEventListener("drop",(t=>{t.preventDefault()})),this.addMoveHandlers(this.dom),this.params.chapterGroup&&this.params.chapterGroup.on("summary",(t=>{this.label.innerText=t.data})),this.updateARIA()}var e=t.prototype;return e.getDOM=function(){return this.dom},e.updateARIA=function(){const t=this.isSelected()?this.params.dictionary.get("a11y.selected"):this.params.dictionary.get("a11y.notSelected");let e="";e=this.params.dictionary.get("a11y.hierarchyLevel").replace(/@level/g,parseInt(this.params.hierarchyLevel));const i=[this.label.innerText,e,t].filter((t=>""!==t.trim())).join(". ");this.dom.setAttribute("aria-label",i)},e.setActive=function(t){this.dom.classList.toggle("current",t),this.dom.setAttribute("tabindex",t?"0":"-1")},e.setSelected=function(t){this.selected=t,this.dom.classList.toggle("selected",t),this.updateARIA()},e.update=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("string"==typeof t.title&&(this.label.innerText=t.title),"number"==typeof t.hierarchyLevel){for(let e=1;e<=this.params.hierarchyLevelMax;e++){const i=`h5peditor-portfolio-chapter-button-level-${e}`;this.dom.classList.toggle(i,e===t.hierarchyLevel)}this.params.hierarchyLevel=t.hierarchyLevel}this.updateARIA()},e.isShown=function(){return this.shown},e.focus=function(){this.dom.focus()},e.show=function(){this.dom.classList.remove("no-display"),this.shown=!0},e.hide=function(){this.dom.classList.add("no-display"),this.shown=!1},e.remove=function(){this.dom.remove()},e.getHierarchieLevel=function(){return this.params.hierarchyLevel},e.toggleDragging=function(t){"boolean"==typeof t&&this.dom.classList.toggle("is-dragging",t)},e.setChildCounter=function(t){this.dom.setAttribute("data-content",t)},e.editLabel=function(){this.label.setAttribute("contentEditable",!0),this.editingLabel=!0;const t=document.createRange();t.selectNodeContents(this.label);const e=window.getSelection();e.removeAllRanges(),e.addRange(t),this.label.focus(),this.label.addEventListener("focusout",this.handleLabelEdited),this.label.addEventListener("keydown",this.handleLabelEdited)},e.getLabel=function(){return this.label.innerText},e.handleLabelEdited=function(t){t instanceof KeyboardEvent&&"Enter"!==t.key||"focusout"===t.type&&t.relatedTarget===this.dom||(this.editingLabel=!1,t.preventDefault(),this.label.removeEventListener("focusout",this.handleLabelEdited),this.label.removeEventListener("keyup",this.handleLabelEdited),this.label.setAttribute("contentEditable",!1),this.label.scrollLeft=0,this.dom.focus(),this.setActive(!0),this.callbacks.onLabelEdited(this,this.label.innerText))},e.disableSubMenu=function(){this.isSubMenuDisabled=!0,this.menu.classList.add("disabled")},e.enableSubMenu=function(){this.isSubMenuDisabled=!1,this.menu.classList.remove("disabled")},e.showSubMenu=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isSubMenuDisabled||(t.setParent(this),this.dom.after(t.getDOM()),setTimeout((()=>{const i=this.dom.getBoundingClientRect();this.menu.setAttribute("aria-label",this.params.dictionary.get("a11y.closeSubmenu")),this.menu.classList.add("active"),t.show({keyboardUsed:e,css:{width:`${i.width}px`,left:`calc(${i.left}px + ${i.width}px - 1.5rem)`,top:`calc(${this.dom.offsetTop}px + ${i.height}px - 1.5rem)`}}),t.once("hidden",(t=>{this.menu.classList.remove("active"),this.menu.setAttribute("aria-label",this.params.dictionary.get("a11y.openSubmenu")),t?.data?.keepFocus||this.dom.focus()}))}),0))},e.handleClickMenu=function(t){this.menu.classList.contains("active")||(this.editingLabel&&this.handleLabelEdited(t),this.callbacks.onShowMenu(this,""===t.pointerType))},e.attachDragPlaceholder=function(){this.dom.parentNode.insertBefore(this.dragPlaceholder,this.dom.nextSibling)},e.showDragPlaceholder=function(){this.isShown()&&(this.updateDragPlaceholderSize(),this.attachDragPlaceholder())},e.hideDragPlaceholder=function(){this.dragPlaceholder.parentNode&&this.dragPlaceholder.parentNode.removeChild(this.dragPlaceholder)},e.updateDragPlaceholderSize=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buttonStyle=this.buttonStyle||window.getComputedStyle(this.dom);const e=this.buttonStyle.getPropertyValue("border-top").split(" ")[0],i=this.buttonStyle.getPropertyValue("border-right").split(" ")[0],n=this.buttonStyle.getPropertyValue("border-bottom").split(" ")[0],s=this.buttonStyle.getPropertyValue("border-left").split(" ")[0];"number"==typeof t.width?t.width=`${t.width}px`:"string"!=typeof t.width&&(t.width=null),t.width=t.width||`calc(${this.dom.offsetWidth}px - ${s} - ${i})`,"number"==typeof t.height?t.height=`${t.height}px`:"string"!=typeof t.height&&(t.height=null),t.height=t.height||`calc(${this.dom.offsetHeight}px - ${e} - ${n} - 2px)`,this.dragPlaceholder.style.width=t.width,this.dragPlaceholder.style.height=t.height},e.addMoveHandlers=function(t){t.addEventListener("mousedown",(t=>{this.callbacks.onShowChapter(this),this.handleMouseUpDown(t,"onMouseDown")})),t.addEventListener("mouseup",(t=>{this.handleMouseUpDown(t,"onMouseUp")})),t.addEventListener("focusout",(t=>{this.handleFocusOut(t)})),t.addEventListener("dragstart",(t=>{this.handleDragStart(t)})),t.addEventListener("dragover",(t=>{this.handleDragOver(t)})),t.addEventListener("dragenter",(t=>{this.handleDragEnter(t)})),t.addEventListener("dragleave",(t=>{this.handleDragLeave(t)})),t.addEventListener("dragend",(t=>{this.handleDragEnd(t)})),t.addEventListener("keydown",(t=>{this.handleKeyDown(t)}))},e.handleMouseUpDown=function(t,e){"onMouseDown"===e&&(this.pointerPosition={x:t.clientX,y:t.clientY}),this.callbacks[e]()},e.handleFocusOut=function(){this.callbacks.onFocusOut(this)},e.handleDragStart=function(t){this.dom.classList.add("over"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(this.dom,this.pointerPosition.x-this.dom.getBoundingClientRect().left,this.pointerPosition.y-this.dom.getBoundingClientRect().top),clearTimeout(this.placeholderTimeout),this.placeholderTimeout=setTimeout((()=>{this.showDragPlaceholder(),this.hide()}),0),this.callbacks.onDragStart(this)},e.handleDragOver=function(t){t.preventDefault()},e.handleDragEnter=function(){this.callbacks.onDragEnter(this)},e.handleDragLeave=function(t){this.dom!==t.target||this.dom.contains(t.fromElement)||this.callbacks.onDragLeave(this)},e.handleDragEnd=function(){clearTimeout(this.placeholderTimeout),this.hideDragPlaceholder(),this.show(),this.dom.classList.remove("over"),this.callbacks.onDragEnd(this)},e.handleKeyDown=function(t){if(!this.editingLabel)if("ArrowUp"===t.code)t.preventDefault(),this.isSelected()?this.callbacks.onMovedUp(this):this.callbacks.onTabPrevious(this);else if("ArrowDown"===t.code)t.preventDefault(),this.isSelected()?this.callbacks.onMovedDown(this):this.callbacks.onTabNext(this);else{if(!this.isSelected())return;"ArrowRight"===t.code?(t.preventDefault(),this.callbacks.onMovedRight(this)):"ArrowLeft"===t.code?(t.preventDefault(),this.callbacks.onMovedLeft(this)):"Delete"===t.code?(t.preventDefault(),this.callbacks.onDelete(this)):"KeyE"===t.code&&(t.preventDefault(),this.callbacks.onEdit(this))}},e.handleSingleClick=function(t){this.editingLabel&&""===t.pointerType||this.editingLabel&&t.target===this.label||(this.editingLabel&&this.handleLabelEdited(t),this.isSelected()||this.callbacks.onShowChapter(this),"mouse"!==t.pointerType&&this.setSelected(!this.isSelected()))},e.handleDoubleClick=function(){this.editLabel()},e.isSelected=function(){return this.selected},t}(),l=function(){function t(){}return t.attach=function(e){if(!e||t.container)return;const i=document.createElement("div");i.classList.add("h5p-hidden-read"),i.setAttribute("aria-live","polite"),e.appendChild(i),t.container=i},t.read=function(e){t.container&&void 0!==e&&("string"==typeof e&&(e=[e]),t.textRead&&(e=[t.textRead,...e]),e=e.map((t=>"."===(t=t.trim()).substring(t.length-1)?t.substring(0,t.length-1):t)),t.textRead=`${e.join(". ")}.`,t.container.innerText=t.textRead,setTimeout((()=>{t.textRead=null,t.container.innerText=""}),100))},t}();l.container=null,l.textRead=null;let d=function(){function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.params=s.extend({title:"",hierarchyLevelMax:4},t),this.callbacks=s.extend({onGetChapterTitle:()=>{},onGetButtonCapabilities:()=>{},onAddChapter:()=>{},onShowChapter:()=>{},onMoveChapter:()=>{},onChangeHierarchy:()=>{},onCloneChapter:()=>{},onDeleteChapter:()=>{}},e),this.buttons=[],this.dom=document.createElement("ol"),this.dom.classList.add("h5peditor-portfolio-chapter-navigation"),this.dom.setAttribute("role","menu"),this.dom.setAttribute("tabindex","-1");const i=document.createElement("div");i.classList.add("h5peditor-portfolio-chapter-navigation-maintitle"),this.titleText=document.createElement("h2"),this.titleText.classList.add("navigation-title"),i.appendChild(this.titleText),this.setTitle(this.params.title),this.dom.appendChild(i),this.buttonSeparator=document.createElement("div"),this.buttonSeparator.classList.add("h5peditor-portfolio-chapter-button-separator"),this.dom.appendChild(this.buttonSeparator),this.buttonAdd=document.createElement("button"),this.buttonAdd.classList.add("h5peditor-portfolio-chapter-button-add"),this.buttonAdd.setAttribute("aria-label",this.params.dictionary.get("l10n.addChapter")),this.buttonAdd.innerText="+",this.buttonAdd.addEventListener("click",(()=>{this.handleAddChapter()})),this.dom.appendChild(this.buttonAdd);for(let t=0;t<this.params.chapterList.getValue().length;t++)this.addButton(t),this.buttons[t].disableSubMenu();this.params.chapterList.forEachChild(((t,e)=>{const i=t.field?.fields?.findIndex((t=>"content"===t.name));-1!==i&&t.children?.[i]?.changes?.push((()=>{this.buttons[e].enableSubMenu()}))})),this.subMenu=new r({dictionary:this.params.dictionary,options:[{id:"edit-label",label:this.params.dictionary.get("l10n.editLabel"),onClick:t=>{this.editButtonLabel(this.getButtonId(t))},keepFocus:!0},{id:"move-up",label:this.params.dictionary.get("l10n.moveUp"),onClick:t=>{this.callbacks.onMoveChapter(this.getButtonId(t),-1)},keepFocus:!0},{id:"move-down",label:this.params.dictionary.get("l10n.moveDown"),onClick:t=>{this.callbacks.onMoveChapter(this.getButtonId(t),1)},keepFocus:!0},{id:"hierarchy-up",label:this.params.dictionary.get("l10n.hierarchyUp"),onClick:t=>{this.callbacks.onChangeHierarchy(this.getButtonId(t),-1)}},{id:"hierarchy-down",label:this.params.dictionary.get("l10n.hierarchyDown"),onClick:t=>{this.callbacks.onChangeHierarchy(this.getButtonId(t),1)}},{id:"clone",label:this.params.dictionary.get("l10n.clone"),onClick:t=>{this.callbacks.onCloneChapter(this.getButtonId(t))}},{id:"clone-plus-subchapters",label:this.params.dictionary.get("l10n.cloneWithSubchapters"),onClick:t=>{this.callbacks.onCloneChapter(this.getButtonId(t),{subchapters:!0})}},{id:"delete",label:this.params.dictionary.get("l10n.delete"),onClick:t=>{this.handleSubMenuDeleted(t)},keepFocus:!0}]}),this.dom.appendChild(this.subMenu.getDOM()),this.deleteDialog=new H5P.ConfirmationDialog({headerText:this.params.dictionary.get("l10n.deleteDialogHeader"),dialogText:this.params.dictionary.get("l10n.deleteDialogText"),cancelText:this.params.dictionary.get("l10n.deleteDialogCancel"),confirmText:this.params.dictionary.get("l10n.deleteDialogConfirm")}),this.deleteDialog.appendTo(document.body)}var e=t.prototype;return e.getDOM=function(){return this.dom},e.getButtonId=function(t){return this.buttons.findIndex((e=>e===t))},e.getButton=function(t){return this.buttons?.[t]||null},e.getChapterGroup=function(t){let e=null;return this.params.chapterList.forEachChild(((i,n)=>{n===t&&(e=i)})),e},e.toggleDragging=function(t){"boolean"==typeof t&&this.buttons.forEach((e=>{e.toggleDragging(t)}))},e.addButton=function(t){const e=this.params.chapterList.getValue();this.buttons[t]=new h({dictionary:this.params.dictionary,title:this.callbacks.onGetChapterTitle(t),chapterGroup:this.getChapterGroup(t),hierarchyLevel:e[t]?.chapterHierarchy?.split("-").length||1,hierarchyLevelMax:this.params.hierarchyLevelMax},{onShowChapter:t=>{this.callbacks.onShowChapter(this.getButtonId(t))},onShowMenu:(t,e)=>{this.handleShowMenu(t,e)},onLabelEdited:(t,e)=>{this.handleLabelEdited(t,e)},onMouseUp:()=>{this.handleMouseUp()},onMouseDown:()=>{this.handleMouseDown()},onDragStart:t=>{this.handleDragStart(t)},onDragEnter:t=>{this.handleDragEnter(t)},onDragLeave:()=>{this.handleDragLeave()},onDragEnd:t=>{this.handleDragEnd(t)},onMovedUp:t=>{this.callbacks.onMoveChapter(this.getButtonId(t),-1)},onMovedDown:t=>{this.callbacks.onMoveChapter(this.getButtonId(t),1)},onMovedLeft:t=>{this.callbacks.onChangeHierarchy(this.getButtonId(t),-1)},onMovedRight:t=>{this.callbacks.onChangeHierarchy(this.getButtonId(t),1)},onDelete:t=>{this.handleSubMenuDeleted(t)},onEdit:t=>{this.editButtonLabel(this.getButtonId(t))},onTabNext:t=>{this.tabTo(t,1,{loop:!0})},onTabPrevious:t=>{this.tabTo(t,-1,{loop:!0})}});const i=document.createElement("li");i.classList.add("h5peditor-portfolio-chapter-button-wrapper"),i.appendChild(this.buttons[t].getDOM()),this.dom.insertBefore(i,this.buttonSeparator)},e.removeButton=function(t){this.buttons[t]&&(this.buttons[t].remove(),this.buttons.splice(t,1))},e.editButtonLabel=function(t){this.buttons[t].editLabel()},e.getButtonLabel=function(t){return this.buttons?.[t].getLabel()??""},e.getButtonLabels=function(t){return this.buttons.filter((e=>"number"!=typeof t||e.getHierarchieLevel()===t)).map((t=>t.getLabel()??""))},e.updateButtons=function(){const t=this.params.chapterList.getValue();this.buttons.forEach(((e,i)=>{e.update({title:this.callbacks.onGetChapterTitle(i),hierarchyLevel:t[i].chapterHierarchy.split("-").length})}))},e.setCurrentButton=function(t){this.buttons.forEach(((e,i)=>{e.setActive(i===t),i===t&&e.focus()}))},e.setSelectedButton=function(t){this.buttons.forEach(((e,i)=>{e.setSelected(i===t)}))},e.setTitle=function(t){"string"==typeof t&&(this.titleText.innerHTML=s.purifyHTML(t))},e.handleSubMenuDeleted=function(t){1!==this.buttons.length?0!==this.getButtonId(t)||1===this.params.chapterList.getValue()[1].chapterHierarchy.split("-").length?(this.deleteDialog.once("confirmed",(()=>{this.deleteDialog.off("canceled"),this.callbacks.onDeleteChapter(this.getButtonId(t))})),this.deleteDialog.once("canceled",(()=>{this.deleteDialog.off("confirmed")})),this.deleteDialog.show()):l.read([this.params.dictionary.get("a11y.notPossible"),this.params.dictionary.get("a11y.firstChapterHierarchyFixed")]):l.read([this.params.dictionary.get("a11y.notPossible"),this.params.dictionary.get("a11y.cannotDeleteOnlyItem")])},e.handleLabelEdited=function(t,e){let i=-1;if("number"==typeof t?(i=t,t=this.buttons[i]):i=this.getButtonId(t),-1===i)return;const n=this.getChapterGroup(i);if(!n)return;const s=n.$content.get(0).querySelectorAll("input.h5peditor-text")[1];s.value=e,s.dispatchEvent(new InputEvent("change",{data:e})),t.updateARIA()},e.handleShowMenu=function(t,e){const i=this.getButtonId(t);-1!==i&&(this.subMenu.toggleOptions(this.callbacks.onGetButtonCapabilities(i)),this.buttons[i].showSubMenu(this.subMenu,e))},e.handleAddChapter=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=null;return this.params.chapterList.addItem(t?.instanceParams)&&(e=this.buttons.length,this.addButton(e),this.callbacks.onAddChapter(e,{doNotShow:t.doNotShow})),e},e.handleMouseDown=function(){this.isMouseDownOnDraggable=!0},e.handleMouseUp=function(){this.isMouseDownOnDraggable=!1},e.handleDragStart=function(t){this.draggedElement=t,this.dragIndexSource=this.getButtonId(this.draggedElement),this.draggedChildrenIndices=this.getChildButtonIndices(this.dragIndexSource),this.draggedChildrenIndices.length&&this.draggedElement.setChildCounter(`+${this.draggedChildrenIndices.length}`),this.draggedChildrenIndices.forEach((t=>{this.buttons[t].hide()})),this.toggleDragging(!0)},e.handleDragEnter=function(t){if((!this.dropzoneElement||this.dropzoneElement!==t)&&(this.dropzoneElement=t,this.dragIndexTarget=this.getButtonId(t),this.draggedElement&&this.dropzoneElement&&this.draggedElement!==this.dropzoneElement)){const t=this.getButtonId(this.draggedElement),e=this.getButtonId(this.dropzoneElement);if(t<0||e<0)return;this.dropzoneElement&&this.draggedElement&&this.draggedElement!==this.dropzoneElement&&this.swapButtons({button1:this.draggedElement,button2:this.dropzoneElement})}},e.swapButtons=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.swapDOMElements(t.button1.getDOM(),t.button2.getDOM());const e=this.getButtonId(t.button1),i=this.getButtonId(t.button2);var n=[this.buttons[i],this.buttons[e]];this.buttons[e]=n[0],this.buttons[i]=n[1],t.skipPlaceholder||t.button1.attachDragPlaceholder()},e.handleDragLeave=function(){this.dropzoneElement=null},e.handleDragEnd=function(){this.toggleDragging(!1);let t=this.draggedElement;if("number"==typeof this.dragIndexTarget&&-1!==this.dragIndexTarget&&this.dragIndexTarget!==this.dragIndexSource){const e=this.dragIndexTarget-this.dragIndexSource;if(this.callbacks.onMoveChapter(this.dragIndexSource,e,{updateNavigationButtons:!1})){for(let t=0;t<this.draggedChildrenIndices.length;t++){const i=this.dragIndexSource+(e>0?0:t+1);this.callbacks.onMoveChapter(i,e,{updateNavigationButtons:!1})}const i=this.dragIndexSource+e-(e<0?0:this.draggedChildrenIndices.length);t=this.buttons[i],this.setSelectedButton(i),this.setCurrentButton(i),this.buttons[this.dragIndexSource].setActive(!1)}else{const t=this.buttons[this.dragIndexSource].getDOM(),e=this.buttons[this.dragIndexTarget].getDOM();this.dragIndexSource<this.dragIndexTarget?t.parentNode.insertBefore(e,t):t.parentNode.insertBefore(e,t.nextSibling);const i=this.buttons.splice(this.dragIndexTarget,1)[0];this.buttons.splice(this.dragIndexSource,0,i)}}this.buttons.forEach((t=>{t.show(),t.setChildCounter("")})),t.focus(),this.draggedElement=null,this.dropzoneElement=null,this.dragIndexSource=null,this.dragIndexTarget=null,this.draggedChildrenIndices=[]},e.tabTo=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.getButtonId(t)+e;!i.loop&&(n<0||n>this.buttons.length-1)||(n%=this.buttons.length,n<0&&(n+=this.buttons.length),t.setActive(!1),this.buttons[n].setActive(!0),this.buttons[n].focus())},e.show=function(){this.dom.classList.remove("display-none")},e.hide=function(){this.dom.classList.add("display-none")},e.getChildButtonIndices=function(t){const e=this.buttons[t].getHierarchieLevel();let i=!1;return this.buttons.reduce(((n,s,o)=>i||o<=t?n:s.getHierarchieLevel()<=e?(i=!0,n):[...n,o]),[])},t}(),c=function(){function t(){this.dom=document.createElement("div"),this.dom.classList.add("preview")}var e=t.prototype;return e.getDOM=function(){return this.dom},e.attachInstance=function(t){"function"==typeof t?.attach&&(this.dom.innerHTML="",t.attach(H5P.jQuery(this.dom)))},t}(),p=function(){function t(t){this.params=t||{},this.dom=document.createElement("div"),this.dom.classList.add("preview-overlay"),this.hide();const e=document.createElement("div");e.classList.add("preview-content"),this.dom.appendChild(e);const i=document.createElement("div");i.classList.add("preview-label"),i.innerHTML=this.params.dictionary.get("l10n.preview"),e.appendChild(i);const n=document.createElement("div");n.classList.add("preview-explanation"),n.innerHTML=this.params.dictionary.get("l10n.previewExplanation"),e.appendChild(n),this.previewWrapper=document.createElement("div"),this.previewWrapper.classList.add("preview-wrapper"),e.appendChild(this.previewWrapper),this.preview=new c,this.previewWrapper.appendChild(this.preview.getDOM())}var e=t.prototype;return e.getDOM=function(){return this.dom},e.attachInstance=function(t){"function"==typeof t?.attach&&(this.setTop(""),this.preview.attachInstance(t))},e.setTop=function(t){"string"==typeof t&&(this.dom.style.top=t)},e.show=function(){this.dom.classList.remove("display-none")},e.hide=function(){this.dom.classList.add("display-none")},e.cloak=function(){this.dom.classList.add("display-invisible")},e.decloak=function(){this.dom.classList.remove("display-invisible")},t}(),u=function(){function t(){this.translation={}}var e=t.prototype;return e.fill=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.translation=this.sanitize(t)},e.get=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.translation;const i=t.split(/[./]+/);return 1===i.length?e[t]:"object"==typeof e[t=i.shift()]?this.get(i.join("."),e[t]):void 0},e.sanitize=function(t){if("object"==typeof t)for(let e in t)t[e]=this.sanitize(t[e]);else if("string"==typeof t){t=(0,n.decode)(t);const e=document.createElement("div");e.innerHTML=t,t=e.textContent||e.innerText||""}return t},t}(),g=function(){function t(){}var e=t.prototype;return e.getChapterDOMs=function(){return this.fieldInstance.$content.get(0).querySelectorAll(".h5p-li > .field-name-chapter > .content")||[]},e.getNewHierarchy=function(){const t=this.params.chapters.reduce(((t,e)=>{const i=(e.chapterHierarchy||"0").split("-")[0];return Math.max(parseInt(i),t)}),0);return t?(t+1).toString():null},e.updateHierarchies=function(){const t=this.params.chapters.reduce(((t,e)=>Math.max(t,e.chapterHierarchy.split("-").length)),1),e=new Array(t).fill(1);let i=0;this.params.chapters.forEach((t=>{const n=t.chapterHierarchy.split("-").length;if(n===i)e[n-1]++;else if(n<i){e[n-1]++;for(let t=n;t<e.length;t++)e[t]=1}i=n,t.chapterHierarchy=e.slice(0,n).join("-")}))},e.addChapter=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this.getNewHierarchy();i&&(this.params.chapters[t].chapterHierarchy=i,this.chapterDOMsOrder.push(t),e.doNotShow||this.showChapter(t),this.setValue(this.field,this.params))},e.getNextCopyLabelNumber=function(t,e){const i=this.chapterNavigation.getButtonLabels(e);t=s.escapeForRegularExpression(t);const n=s.escapeForRegularExpression(this.dictionary.get("l10n.labelCopy")),o=new RegExp(`^${t} (${n})( \\(((\\d+))\\))?$`);return i.map((t=>{const e=o.exec(t);return parseInt(e?.[3]??(e?.[1]?"1":"0"))})).reduce(((t,e)=>Math.max(t,e+1)),1)},e.getChapterBaseName=function(t){const e=s.escapeForRegularExpression(this.dictionary.get("l10n.labelCopy")),i=new RegExp(`^(.+) ${e}( \\(\\d+\\))?$`);return t.match(i)?.[1]??t},e.cloneChapter=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"number"==typeof t&&(this.showCopySpinner(),window.setTimeout((()=>{const i=this.chapterList.getValue(),n=i[t].chapterHierarchy,o=i.reduce(((t,e,i)=>{const s=e.chapterHierarchy,o=0===s.indexOf(`${n}-`);return s===n||o?[...t,{index:i,level:s.split("-").length,isSubchapter:o}]:t}),[]),a=-i.length+t+o.length;let r;o.forEach((t=>{if(!e.subchapters&&t.isSubchapter)return;const n=this.getChapterBaseName(this.chapterNavigation.getButtonLabel(t.index)),o=this.getNextCopyLabelNumber(n,t.level),h=o<2?"":` (${o})`,l=`${n} ${this.dictionary.get("l10n.labelCopy")} ${h}`,d=s.replaceSubContentIDs({...i[t.index]}),c=this.chapterNavigation.handleAddChapter({instanceParams:d,doNotShow:!0});if(c){for(let e=0;e<t.level-1;e++)this.changeHierarchy(this.chapterList.getValue().length-1,1);this.chapterNavigation.handleLabelEdited(c,l),void 0===r&&(r=c+a);for(let t=0;t<Math.abs(a);t++)this.moveChapter(c+t*Math.sign(a),Math.sign(a),{doNotShow:!0,silent:!0,doNotSave:!0})}})),"number"==typeof r&&(this.setValue(this.field,this.params),this.showChapter(r)),this.spinner.hide()}),0))},e.deleteChapter=function(t){if("number"!=typeof t)return;if(1===this.params.chapters.length)return void l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.cannotDeleteOnlyItem")]);if(0===t&&1!==this.params.chapters[1].chapterHierarchy.split("-").length)return void l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.firstChapterHierarchyFixed")]);this.chapterDOMsOrder.splice(t,1),this.chapterDOMsOrder=this.chapterDOMsOrder.map((e=>e<t?e:e-1));const e=0===t?1:t-1;this.showChapter(e),this.chapterList.removeItem(t),this.chapterNavigation.removeButton(t),this.setValue(this.field,this.params)},e.moveChapter=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("number"!=typeof t||t<0||t>this.params.chapters.length-1||"number"!=typeof e)return!1;const n=t+e;if(n<0)return i.silent||l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.positionMinReached")]),!1;if(n>this.params.chapters.length-1)return i.silent||l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.positionMaxReached")]),!1;if(0===n&&1!==this.params.chapters[t].chapterHierarchy.split("-").length)return i.silent||l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.firstChapterHierarchyFixed")]),!1;this.chapterList.moveItem(t,n),!1!==i.updateNavigationButtons&&this.chapterNavigation.swapButtons({button1:this.chapterNavigation.getButton(t),button2:this.chapterNavigation.getButton(n),skipPlaceholder:!0});const s=this.chapterDOMsOrder.splice(t,1);return this.chapterDOMsOrder.splice(n,0,s[0]),this.updateHierarchies(),this.chapterNavigation.updateButtons(),i.doNotShow||this.showChapter(n),i.doNotSave||this.setValue(this.field,this.params),!0},e.changeHierarchy=function(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e)return void(n.silent||l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.firstChapterHierarchyFixed")]));const s=this.params.chapters[e].chapterHierarchy.split("-").length;if(s+i<1)return void(n.silent||l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.hierarchyMinReached").replace(/@level/g,1)]));if(s+i>t.MAX_LEVEL)return void(n.silent||l.read([this.dictionary.get("a11y.notPossible"),this.dictionary.get("a11y.hierarchyMaxReached").replace(/@level/g,1)]));const o=Math.min(Math.max(1,s+i),t.MAX_LEVEL);if(s===o)return;let a;a=s<o?[...this.params.chapters[e].chapterHierarchy.split("-"),Array(o-s).fill("0")]:Array(o).fill("0"),a=a.join("-"),this.params.chapters[e].chapterHierarchy=a,this.updateHierarchies(),this.chapterNavigation.updateButtons(),n.silent||l.read(this.dictionary.get("a11y.hierarchyChangedTo").replace(/@level/g,o)),n.doNotSave||this.setValue(this.field,this.params)},e.showChapter=function(t){const e=this.getChapterDOMs();for(let i=0;i<e.length;i++){e[i].classList.toggle("active",i===this.chapterDOMsOrder[t]);const n=e[i].closest("li");n&&n.classList.toggle("display-none",i!==this.chapterDOMsOrder[t])}this.chapterNavigation.setCurrentButton(t)},e.getChapterTitle=function(t){let e=this.params.chapters[t]?.content?.metadata?.title;return e||(e=`${this.dictionary.get("l10n.chapter")} ${t}`),e},e.getButtonCapabilities=function(e){const i={"edit-label":!0};return i["move-up"]=0!==e&&(1!==e||1===this.params.chapters[1]?.chapterHierarchy?.split("-")?.length),i["move-down"]=e!==this.params.chapters.length-1&&(0!==e||1===this.params.chapters[1]?.chapterHierarchy?.split("-")?.length),i["hierarchy-up"]=0!==e&&this.params.chapters[e]?.chapterHierarchy?.split("-")?.length>1,i["hierarchy-down"]=this.params.chapters[e]?.chapterHierarchy?.split("-")?.length<t.MAX_LEVEL&&0!==e,i.delete=0!==e||1===this.params.chapters[1]?.chapterHierarchy?.split("-")?.length,i["clone-plus-subchapters"]=this.params.chapters[e]?.chapterHierarchy?.split("-")?.length<t.MAX_LEVEL,i},t}();g.MAX_LEVEL=4;let b=function(){function t(){}var e=t.prototype;return e.openExportDialog=async function(){this.createPreviewInstance(!0),this.previewInstance&&(this.chapterNavigation.hide(),this.chaptersDOM.classList.add("display-none"),this.previewOverlay.cloak(),this.previewOverlay.show(),this.previewOverlay.attachInstance(this.previewInstance),l.read(this.dictionary.get("a11y.exportOpened")),this.chapterChooser.update({instance:this.previewInstance}),this.chapterChooser.show(),window.requestAnimationFrame((()=>{const t=this.previewOverlay.getDOM().getBoundingClientRect();t.top+t.height>0&&this.previewOverlay.setTop(-t.height-screen.height+"px")})))},e.toggleExportDialog=function(t){t?(this.toolBar.forceButton("preview",!1),this.toolBar.disableButton("deleteHidden"),this.openExportDialog()):(this.allChildrenDone&&!this.toolBar.isButtonActive("preview")&&this.toolBar.enableButton("deleteHidden"),this.closeExportDialog())},e.showExportSpinner=function(){this.spinner.setMessage(`${this.dictionary.get("l10n.generatingExport")}. ${this.dictionary.get("l10n.pleaseKeepTabActive")}`),this.spinner.setProgress(" "),this.spinner.show()},e.closeExportDialog=function(){this.togglePreview({active:!1}),this.previewInstance=null,this.previewOverlay.decloak(),this.previewOverlay.hide(),this.chapterNavigation.show(),this.chaptersDOM.classList.remove("display-none"),this.chapterChooser.hide(),this.spinner.hide(),l.read(this.dictionary.get("a11y.exportClosed"))},t}(),m=function(){function t(){}var e=t.prototype;return e.sanitize=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t=t.filter((t=>new RegExp("^[1-9][0-9]*(-[1-9][0-9]*)*$").test(t.chapterHierarchy)));const e=t.reduce(((t,e)=>Math.max(t,e.chapterHierarchy.split("-").length)),1);return t=t.sort(((t,i)=>{const n=t.chapterHierarchy.split("-");for(;n.length<e;)n.push(0);const s=i.chapterHierarchy.split("-");for(;s.length<e;)s.push(0);let o=0;for(let t=0;t<n.length;t++){if(parseInt(n[t])<parseInt(s[t])){o=-1;break}if(parseInt(n[t])>parseInt(s[t])){o=1;break}}return o})),t.length||(t=[{id:0,chapterHierarchy:"1"}]),t},e.handleChapterDone=function(t){this.chaptersDone.includes(t)||(this.chaptersDone.push(t),this.chaptersPending--,0===this.chaptersPending&&this.handleAllChildrenDone())},e.handleAllChildrenDone=function(){this.allChildrenDone=!0,this.toolBar.enableButton("deleteHidden")},e.listenToHeaderFooter=function(){const t=this.parent.children.find((t=>"showHeader"===t?.field?.name));t?.changes.push((t=>{this.handleTogglingHeaderFooter("header",t)}));const e=this.parent.children.find((t=>"showFooter"===t?.field?.name));e?.changes.push((t=>{this.handleTogglingHeaderFooter("footer",t)}))},e.overrideH5PCoreTitleField=function(){const t=this.$container.get(0).closest(".h5p-portfolio-editor");if(t){const e=t.querySelector(".field-name-extraTitle .h5peditor-label");e&&(e.innerHTML=this.dictionary.get("l10n.portfolioTitle"));const i=t.querySelector(".field-name-extraTitle .h5peditor-text");i&&(this.contentTitle=i.value,i.addEventListener("keydown",(t=>{"Enter"!==t.code&&"Tab"!==t.code||(this.contentTitle=i.value,this.setChapterNavigationTitle(i.value))})))}},e.overrideHeaderFooter=function(){const t=this.$container.get(0).closest(".h5p-portfolio-editor");if(!t)return;const e=t.querySelector(".field-name-headerPlaceholderGroup .title");e&&(e.innerText=this.dictionary.get("l10n.header"));const i=t.querySelector(".field-name-footerPlaceholderGroup .title");i&&(i.innerText=this.dictionary.get("l10n.footer"))},e.overrideCoverTitle=function(){const t=this.$container.get(0).closest(".h5p-portfolio-editor");if(!t)return;const e=t.querySelector(".field-name-bookCover");if(!e)return;const i=e.querySelector(".title");if(i){const t=i.cloneNode(!0);t.innerText=this.dictionary.get("l10n.cover"),i.parentNode.insertBefore(t,i),i.remove();const n=()=>{e.classList.contains("expanded")?(i.setAttribute("aria-expanded","false"),window.setTimeout((()=>{e.classList.remove("expanded")}),100)):(i.setAttribute("aria-expanded","true"),window.setTimeout((()=>{e.classList.add("expanded")}),100))};t.addEventListener("click",n)}},e.fillDictionary=function(){const t=H5PEditor.language["H5PEditor.Portfolio"].libraryStrings||{},e={};for(const i in t){let n=e;const s=i.split(/[./]+/),o=s.pop();s.forEach((t=>{n[t]||(n[t]={}),n=n[t]})),n[o]=t[i]}this.dictionary.fill(e)},t}(),f=function(){function t(){}var e=t.prototype;return e.togglePreview=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"boolean"==typeof t.active&&(t.active?(this.toolBar.forceButton("export",!1),this.toolBar.disableButton("deleteHidden"),this.openPreview()):(this.allChildrenDone&&!this.toolBar.isButtonActive("export")&&this.toolBar.enableButton("deleteHidden"),this.closePreview()))},e.openPreview=function(){this.createPreviewInstance(),this.previewInstance&&(this.chapterNavigation.hide(),this.chaptersDOM.classList.add("display-none"),this.previewOverlay.show(),this.previewOverlay.attachInstance(this.previewInstance),l.read(this.dictionary.get("a11y.previewOpened")))},e.closePreview=function(){this.previewInstance=null,this.previewOverlay.decloak(),this.previewOverlay.hide(),this.chapterNavigation.show(),this.chaptersDOM.classList.remove("display-none"),l.read(this.dictionary.get("a11y.previewClosed"))},e.createPreviewInstance=function(){const t=Object.keys(H5PEditor.libraryLoaded).find((t=>"H5P.Portfolio"===t.split(" ")[0])),e=this.filterContentTypesNotPreviewable(this.parent.params);e.behaviour.isPreview=!0,this.previewInstance=H5P.newRunnable({library:t,params:e},H5PEditor.contentId||1,void 0,void 0,{metadata:{title:this.contentTitle}}),this.previewInstance},e.filterContentTypesNotPreviewable=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=JSON.parse(JSON.stringify(e)),n=i?.portfolio?.chapters;if(!n||!Array.isArray(n))return e;const s=n.map((e=>{let i=e.content?.params?.chapter?.contents;return i?(i=i.map((e=>{let i=e?.content?.params?.placeholder?.fields;return i?(i=i.map((e=>{const i=e?.content?.library?.split(" ").shift();return t.CONTENT_TYPES_WITHOUT_PREVIEW.includes(i)&&(e.content={library:"H5P.AdvancedText 1.1",params:{text:`<p align="center">${i.split(".")[1]}</p>                  <p align="center">                    ${this.dictionary.get("l10n.noPreviewPossible")}                  </p>`}}),e})),e):e})),e.content.params.chapter.contents=i,e):e}));return i.portfolio.chapters=s,i},t}();f.CONTENT_TYPES_WITHOUT_PREVIEW=["H5P.Timeline"];let v=function(){function t(t,e){this.params=s.extend({a11y:{active:"",disabled:"",inactive:""},active:!1,classes:[],disabled:!1,type:"pulse"},t||{}),Array.isArray(this.params.classes)||(this.params.classes=[this.params.classes]),"pulse"===this.params.type&&(this.params.a11y.inactive||(this.params.a11y.inactive=this.params.a11y.active||""),this.params.a11y.active||(this.params.a11y.active=this.params.a11y.inactive||"")),this.active=this.params.active,this.disabled=this.params.disabled,this.callbacks=e||{},this.callbacks.onClick=this.callbacks.onClick||(()=>{}),this.button=document.createElement("button"),this.params.classes&&this.params.classes.forEach((t=>{this.button.classList.add(t)})),this.button.setAttribute("aria-pressed",this.params.active),this.button.setAttribute("tabindex","0"),!0===this.params.active?this.activate():this.deactivate(),!0===this.params.disabled?this.disable():this.enable(),this.button.addEventListener("click",(t=>{this.disabled||("toggle"===this.params.type&&this.toggle(),this.callbacks.onClick(t,{active:this.active}))}))}var e=t.prototype;return e.getDOM=function(){return this.button},e.show=function(){this.button.classList.remove("toolbar-button-display-none")},e.hide=function(){this.button.classList.add("toolbar-button-display-none")},e.decloak=function(){this.button.classList.remove("toolbar-button-cloak")},e.cloak=function(){this.button.classList.add("toolbar-button-cloak")},e.focus=function(){this.button.focus()},e.enable=function(){this.disabled=!1,this.button.classList.remove("toolbar-button-disabled"),this.active?this.activate():this.deactivate()},e.disable=function(){this.button.classList.add("toolbar-button-disabled"),this.button.setAttribute("aria-label",this.params.a11y.disabled),this.disabled=!0},e.activate=function(){this.disabled||("toggle"===this.params.type&&(this.button.classList.add("toolbar-button-active"),this.button.setAttribute("aria-pressed",!0)),this.button.setAttribute("aria-label",this.params.a11y.active),this.active=!0)},e.force=function(t){"toggle"===this.params.type&&(!0===t?this.activate():!1===t?this.deactivate():this.toggle()),this.callbacks.onClick(event,{active:this.active})},e.deactivate=function(){this.disabled||(this.active=!1,"toggle"===this.params.type&&(this.button.classList.remove("toolbar-button-active"),this.button.setAttribute("aria-pressed",!1)),this.button.setAttribute("aria-label",this.params.a11y.inactive))},e.toggle=function(){this.disabled||(this.active?this.deactivate():this.activate())},e.setAttribute=function(t,e){this.button.setAttribute(t,e)},e.isActive=function(){return this.active},e.isDisabled=function(){return this.disabled},e.isCloaked=function(){return this.button.classList.contains("toolbar-button-cloak")},t}(),y=function(){function t(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.params=s.extend({},e),this.callbacks=s.extend({onClickButtonPreview:()=>{},onClickButtonExport:()=>{},onClickButtonDeleteHidden:()=>{}},i),this.buttons={},this.toolBar=document.createElement("div"),this.toolBar.classList.add("toolbar-tool-bar"),this.buttons.preview=new v({a11y:{active:this.params.dictionary.get("a11y.previewActive"),disabled:this.params.dictionary.get("a11y.previewDisabled"),inactive:this.params.dictionary.get("a11y.previewInactive")},classes:["toolbar-button","toolbar-button-preview"],disabled:!0,type:"toggle"},{onClick:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.callbacks.onClickButtonPreview(i.active)}}),this.toolBar.appendChild(this.buttons.preview.getDOM()),this.buttons.export=new v({a11y:{active:this.params.dictionary.get("a11y.exportActive"),disabled:this.params.dictionary.get("a11y.exportDisabled"),inactive:this.params.dictionary.get("a11y.exportInactive")},classes:["toolbar-button","toolbar-button-export"],disabled:!0,type:"toggle"},{onClick:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.callbacks.onClickButtonExport(i.active)}}),this.toolBar.appendChild(this.buttons.export.getDOM()),this.buttons.deleteHidden=new v({a11y:{active:this.params.dictionary.get("a11y.deleteHiddenActive"),disabled:this.params.dictionary.get("a11y.deleteHiddenDisabled"),inactive:this.params.dictionary.get("a11y.deleteHiddenInactive")},classes:["toolbar-button","toolbar-button-delete-hidden"],disabled:!0,type:"pulse"},{onClick:()=>{this.callbacks.onClickButtonDeleteHidden()}}),this.toolBar.appendChild(this.buttons.deleteHidden.getDOM())}var e=t.prototype;return e.getDOM=function(){return this.toolBar},e.setButtonAttributes=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.buttons[t])for(let i in e)this.buttons[t].setAttribute(i,e[i])},e.isButtonActive=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!this.buttons[t]&&this.buttons[t].isActive()},e.forceButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;this.buttons[t]&&this.buttons[t].force(e)},e.enableButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&this.buttons[t].enable()},e.disableButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&this.buttons[t].disable()},e.showButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&this.buttons[t].show()},e.hideButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&this.buttons[t].hide()},e.decloakButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&this.buttons[t].decloak()},e.cloakButton=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&this.buttons[t].cloak()},e.focus=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.buttons[t]&&!this.buttons[t].isCloaked()&&this.buttons[t].focus()},t}(),E=function(){function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=s.extend({hasAbortButton:!1},t),e=s.extend({onAborted:()=>{}},e),this.container=document.createElement("div"),this.container.classList.add("spinner-container"),this.container.classList.add("spinner-none"),this.spinnerElement=document.createElement("div"),this.spinnerElement.classList.add("spinner");const i=document.createElement("div");i.classList.add("spinner-circle-head"),this.spinnerElement.append(i);const n=document.createElement("div");n.classList.add("spinner-circle-neck-upper"),this.spinnerElement.append(n);const o=document.createElement("div");o.classList.add("spinner-circle-neck-lower"),this.spinnerElement.append(o);const a=document.createElement("div");a.classList.add("spinner-circle-body"),this.spinnerElement.append(a),this.container.append(this.spinnerElement),this.message=document.createElement("div"),this.message.classList.add("spinner-message"),this.container.append(this.message),this.progress=document.createElement("div"),this.progress.classList.add("spinner-progress"),this.container.append(this.progress),t.hasAbortButton&&(this.abortButton=document.createElement("button"),this.abortButton.classList.add("h5p-joubelui-button"),this.abortButton.classList.add("spinner-button-abort"),this.abortButton.innerText=t.dictionary.get("l10n.abort"),this.abortButton.addEventListener("click",(()=>{e.onAborted()})),this.container.append(this.abortButton))}var e=t.prototype;return e.getDOM=function(){return this.container},e.show=function(){this.container.classList.remove("spinner-none")},e.hide=function(){this.container.classList.add("spinner-none")},e.setMessage=function(t){this.message.innerText=t},e.setProgress=function(t){this.progress.innerText=t},t}();var L=i(5733),w=i(1819),C=i(8344);let M=function(){function t(){}return t.exportPDF=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(i.aborted)return;if(i.addEventListener("abort",(()=>{})),!Array.isArray(e.imageBlobs))return;e.filename=e.filename||`${H5P.createUUID()}-${Date.now()}.pdf`;const n=new w.kH;let s=t.PAGE_HEIGHT_MAX_MM,o=!1;e.imageBlobs.forEach(((e,a)=>{if(i.aborted)return;a>0&&(e.title||s<=0)&&(n.addPage(),s=t.PAGE_HEIGHT_MAX_MM),e.title&&(n.text(e.title||e.name,t.PAGE_MARGIN_MM,1.5*t.PAGE_MARGIN_MM),s-=t.PAGE_MARGIN_MM);const r=document.createElement("img");r.src=URL.createObjectURL(e.blob);const h=n.getImageProperties(r),l=h.width/h.height;if(1===h.height&&1===h.width)return;let d={width:t.PAGE_WIDTH_MAX_MM,height:t.PAGE_WIDTH_MAX_MM/l};d.height>s&&(o?(n.addPage(),s=t.PAGE_HEIGHT_MAX_MM,o=!1,d.height>s&&(d={width:s*l,height:s})):d={width:s*l,height:s}),n.addImage(r,"JPEG",t.PAGE_MARGIN_MM,t.PAGE_MARGIN_MM+t.PAGE_HEIGHT_MAX_MM-s,d.width,d.height),o=!0,s-=d.height,s-=10})),i.aborted||n.save(e.filename)},t.createDOCX=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(i.aborted)return;i.addEventListener("abort",(()=>{}));const n=[];for(let s=0;s<e.imageBlobs.length;s++){if(i.aborted)return;e.imageBlobs[s].title&&n.push(new C.nvN({children:[new C.hal(e.imageBlobs[s].title)],heading:C.y5t.HEADING_1,pageBreakBefore:!0,spacing:{after:(0,C.rqT)(t.PAGE_MARGIN_MM)}}));const o=await t.getImage(e.imageBlobs[s].blob),a=o.naturalWidth/o.naturalHeight;if(1===o.naturalWidth&&1===o.naturalHeight)continue;let r={width:t.PAGE_WIDTH_MAX_MM*t.MM_EQUALS_PX,height:t.PAGE_WIDTH_MAX_MM*t.MM_EQUALS_PX/a};r.height>t.PAGE_HEIGHT_MAX_MM*t.MM_EQUALS_PX&&(r={width:t.PAGE_HEIGHT_MAX_MM*t.MM_EQUALS_PX*a,height:t.PAGE_HEIGHT_MAX_MM*t.MM_EQUALS_PX}),n.push(new C.nvN({children:[new C._oj({data:e.imageBlobs[s].blob,transformation:{width:r.width,height:r.height}})],spacing:{after:(0,C.rqT)(t.PAGE_MARGIN_MM)}}))}if(i.aborted)return;const s=new C.BBB({sections:[{properties:{page:{size:{orientation:C.gf0.PORTRAIT,height:(0,C.rqT)(t.PAGE_HEIGHT_MM),width:(0,C.rqT)(t.PAGE_WIDTH_MM)},margin:{top:(0,C.rqT)(t.PAGE_MARGIN_MM),right:(0,C.rqT)(t.PAGE_MARGIN_MM),bottom:(0,C.rqT)(t.PAGE_MARGIN_MM),left:(0,C.rqT)(t.PAGE_MARGIN_MM)}}},children:n}]});return i.aborted?void 0:await C.UDs.toBlob(s).then((t=>t))},t.createZip=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;return await new Promise((i=>{e.aborted&&i(null),e.addEventListener("abort",(()=>{i(null)})),Array.isArray(t)||i(null),t=t.filter((t=>t.blob instanceof Blob)).map((t=>("string"!=typeof t.name&&(t.name=`${H5P.createUUID()}.${t.blob.type.split("/")[1]}`),t))),t.length||i(null);const n=new L;t.forEach((t=>{e.aborted&&i(null),n.file(t.name,t.blob)})),e.aborted&&i(null),n.generateAsync({type:"blob"}).then((t=>{i(t)}))}))},t.getImage=async function(t){return await new Promise(((e,i)=>{const n=document.createElement("img");n.addEventListener("load",(()=>{e(n)})),n.addEventListener("error",(()=>{i(null)})),n.src=URL.createObjectURL(t)}))},t.offerDownload=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.blob)return;t.filename||(t.filename=Date.now().toString());const e=URL.createObjectURL(t.blob),i=document.createElement("a");i.href=e,i.download=t.filename;const n=()=>{setTimeout((()=>{URL.revokeObjectURL(e),i.removeEventListener("click",n)}),150)};i.addEventListener("click",n,!1),i.click()},t}();M.PAGE_WIDTH_MM=210,M.PAGE_HEIGHT_MM=297,M.PAGE_MARGIN_MM=10,M.PAGE_WIDTH_MAX_MM=M.PAGE_WIDTH_MM-2*M.PAGE_MARGIN_MM,M.PAGE_HEIGHT_MAX_MM=M.PAGE_HEIGHT_MM-2*M.PAGE_MARGIN_MM,M.MM_EQUALS_PX=3.7795275591;var x=i(1120);let D=function(){function t(){}return t.takeScreenshot=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.aborted)return null;e.addEventListener("abort",(()=>null)),t.element||(t.element=document.body);const i=await x(t.element);return(t.enforceImage&&"0"===i.getAttribute("height")||"0"===i.getAttribute("width"))&&(i.setAttribute("height","1"),i.setAttribute("width","1")),await new Promise((t=>{i.toBlob((e=>{t(e)}),"image/png")}))},t}();function A(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,s,o,a,r=[],h=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(n=o.call(i)).done)&&(r.push(n.value),r.length!==e);h=!0);}catch(t){l=!0,s=t}finally{try{if(!h&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw s}}return r}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return I(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}let P=function(){function t(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.params=s.extend({},t),this.callbacks=s.extend({onExportStarted:()=>{},onExportProgress:()=>{},onExportEnded:()=>{}},e),this.abortController=new AbortController,this.checkboxes=[],this.dom=document.createElement("div"),this.dom.classList.add("chapter-chooser-overlay");const i=document.createElement("div");i.classList.add("chapter-chooser-content"),this.dom.appendChild(i);const n=document.createElement("div");n.classList.add("chapter-chooser-title"),n.innerHTML=this.params.dictionary.get("l10n.chooseChapters"),i.appendChild(n);const o=document.createElement("div");o.classList.add("chapter-chooser-description"),o.innerHTML=this.params.dictionary.get("l10n.chooseChaptersDescription"),i.appendChild(o);const a=document.createElement("div");a.classList.add("chapter-chooser-actions"),i.appendChild(a);const r=document.createElement("div");r.classList.add("chapter-chooser-toggle-all-wrapper"),a.appendChild(r),this.toggleAll=document.createElement("input"),this.toggleAll.classList.add("chapter-chooser-checkbox"),this.toggleAll.setAttribute("type","checkbox"),this.toggleAll.setAttribute("id","chapter-chooser-checkbox-toggle-all"),this.toggleAll.setAttribute("aria-label",this.params.dictionary.get("a11y.selectAll")),this.toggleAll.addEventListener("change",(()=>{this.toggleAll.checked?this.toggleAll.setAttribute("aria-label",this.params.dictionary.get("a11y.unselectAll")):this.toggleAll.setAttribute("aria-label",this.params.dictionary.get("a11y.selectAll")),this.checkboxes.forEach((t=>{t.checked=this.toggleAll.checked})),this.updateButtons()})),r.appendChild(this.toggleAll),this.toggleAllLabel=document.createElement("label"),this.toggleAllLabel.classList.add("chapter-chooser-label-toggle-all"),this.toggleAllLabel.innerText=this.params.dictionary.get("l10n.selectAll"),r.appendChild(this.toggleAllLabel),this.optionsList=document.createElement("ul"),this.optionsList.classList.add("chapter-chooser-list"),a.appendChild(this.optionsList);const h=document.createElement("div");h.classList.add("chapter-chooser-buttons-wrapper"),a.appendChild(h),this.buttonExportImages=document.createElement("button"),this.buttonExportImages.classList.add("h5peditor-button"),this.buttonExportImages.classList.add("h5peditor-button-textual"),this.buttonExportImages.classList.add("chapter-chooser-export-button"),this.buttonExportImages.innerText=this.params.dictionary.get("l10n.exportImages"),this.buttonExportImages.addEventListener("click",(()=>{this.handleExport("images",this.abortController.signal)})),h.appendChild(this.buttonExportImages),this.buttonExportPDF=document.createElement("button"),this.buttonExportPDF.classList.add("h5peditor-button"),this.buttonExportPDF.classList.add("h5peditor-button-textual"),this.buttonExportPDF.classList.add("chapter-chooser-export-button"),this.buttonExportPDF.innerText=this.params.dictionary.get("l10n.exportPDF"),this.buttonExportPDF.addEventListener("click",(()=>{this.handleExport("pdf",this.abortController.signal)})),h.appendChild(this.buttonExportPDF),this.buttonExportDOCX=document.createElement("button"),this.buttonExportDOCX.classList.add("h5peditor-button"),this.buttonExportDOCX.classList.add("h5peditor-button-textual"),this.buttonExportDOCX.classList.add("chapter-chooser-export-button"),this.buttonExportDOCX.innerText=this.params.dictionary.get("l10n.exportDOCX"),this.buttonExportDOCX.addEventListener("click",(()=>{this.handleExport("docx",this.abortController.signal)})),h.appendChild(this.buttonExportDOCX),this.hide(),this.updateButtons()}var e=t.prototype;return e.getDOM=function(){return this.dom},e.setAbortController=function(t){this.abortController=t},e.update=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.instance)return;this.instance=t.instance,this.toggleAll.checked=!1,this.checkboxes=[],this.optionsList.innerHTML="";let e=0;if(this.instance.params.showCoverPage){const t={hierarchy:"0",title:this.params.dictionary.get("l10n.coverPage")},i=this.buildListItem(t,0),n=i.li,s=i.checkbox;this.checkboxes.push(s),this.optionsList.appendChild(n),e++}this.instance.getChaptersInformation().forEach(((t,i)=>{const n=this.buildListItem(t,i+e),s=n.li,o=n.checkbox;this.checkboxes.push(o),this.optionsList.appendChild(s)})),this.updateButtons()},e.buildListItem=function(t,e){const i=document.createElement("li");i.classList.add("chapter-chooser-list-item"),i.classList.add(`hierarchy-${t.hierarchy.split("-").length}`);const n=H5P.createUUID(),s=document.createElement("input");s.classList.add("chapter-chooser-checkbox"),s.setAttribute("type","checkbox"),s.setAttribute("id",`chapter-chooser-checkbox-${e}-${n}`),s.setAttribute("aria-label",t.title),s.addEventListener("change",(()=>{this.updateButtons()})),i.appendChild(s);const o=document.createElement("label");return o.classList.add("chapter-chooser-label"),o.setAttribute("for",`chapter-chooser-checkbox-${e}-${n}`),o.innerText=t.title,i.appendChild(o),{li:i,checkbox:s}},e.updateButtons=function(){this.checkboxes.every((t=>t.checked))?this.toggleAllLabel.innerHTML=this.params.dictionary.get("l10n.unselectAll"):this.toggleAllLabel.innerHTML=this.params.dictionary.get("l10n.selectAll"),this.checkboxes.some((t=>t.checked))?(this.buttonExportImages.removeAttribute("disabled"),this.buttonExportPDF.removeAttribute("disabled"),this.buttonExportDOCX.removeAttribute("disabled")):(this.buttonExportImages.setAttribute("disabled","disabled"),this.buttonExportPDF.setAttribute("disabled","disabled"),this.buttonExportDOCX.setAttribute("disabled","disabled"))},e.show=function(){this.dom.classList.remove("display-none")},e.hide=function(){this.dom.classList.add("display-none")},e.getCover=async function(t,e){if(e.aborted)return;e.addEventListener("abort",(()=>{}));const i=this.instance.getCoverDOM(),n=i.querySelector(".h5p-portfolio-cover-readbutton");n&&n.classList.add("display-none");const s=await D.takeScreenshot({element:i,enforceImage:t},e);return n&&n.classList.remove("display-none"),s},e.getScreenshots=async function(e,i,n){return n.aborted?[]:(n.addEventListener("abort",(()=>[])),await new Promise((o=>{this.instance.moveTo({id:e}),setTimeout((async()=>{const a=[],r=this.instance.getChaptersInformation(e)?.placeholderDOMs||[];let h,l;for(let e=0;e<r.length&&(n.aborted&&o([[]]),!l);e++){let o=t.MAX_RETRIES_PER_SHOT;for(;o>0&&!n.aborted;){try{h=await D.takeScreenshot({element:r[e],enforceImage:i},this.abortController.signal),o=-1,l=void 0}catch(e){o!==t.MAX_RETRIES_PER_SHOT||n.aborted||(l=[this.params.dictionary.get("l10n.cannotExportSomeContent"),this.params.dictionary.get("l10n.pleaseKeepTabActive")].join(" ")),o-=1}o>0&&await s.wait(t.RETRY_TIMEOUT_MS)}h&&a.push(h)}o([a,l])}),500)})))},e.handleExport=async function(e,i){if("string"!=typeof e)return;this.callbacks.onExportStarted();let n=null;await s.wait(5),await(async()=>{if(i.aborted)return void this.callbacks.onExportEnded();i.addEventListener("abort",(()=>{this.callbacks.onExportEnded()}));const s=this.instance.getChaptersInformation(),o=this.checkboxes.reduce(((t,e,i)=>{let n=i;if(this.instance.params.showCoverPage){if(0===i)return t;n--}if(!e.checked)return t;const o={index:n,hierarchy:s[n].hierarchy,title:s[n].title};return[...t,o]}),[]);let a=[];if(this.instance.params.showCoverPage&&this.checkboxes[0].checked){this.callbacks.onExportProgress({text:this.params.dictionary.get("l10n.processingCover")});const t=await this.getCover("images"!==e,i);if(t){const e=this.params.dictionary.get("l10n.coverPage").replace(/[/\\?%*:|"<>]/g,"-").toLowerCase();a.push({title:null,name:`${e}.${t.type.split("/")[1]}`,blob:t})}}this.instance.handleCoverRemoved({skipFocus:!0}),this.instance.isMenuOpen()&&this.instance.toggleMenu();for(let t=0;t<o.length;t++){this.callbacks.onExportProgress({number:t+1,of:o.length});const s=A(await this.getScreenshots(o[t].index,"images"!==e,i),2),r=s[0],h=s[1];if(h){n=h;break}if(r?.length)for(let e=0;e<r.length;e++)a.push({title:0===e?o[t].title:null,name:`${o[t].hierarchy}_${e}.${r[e].type.split("/")[1]}`,blob:r[e]})}n?this.callbacks.onExportEnded(n):(this.callbacks.onExportProgress({text:this.params.dictionary.get("l10n.creatingExportFile")}),i.aborted||("images"===e?M.offerDownload({blob:await M.createZip(a,i),filename:`${t.FILENAME_PREFIX}-${Date.now()}.zip`}):"pdf"===e?M.exportPDF({imageBlobs:a,filename:`${t.FILENAME_PREFIX}-${Date.now()}.pdf`},i):"docx"===e&&M.offerDownload({blob:await M.createDOCX({imageBlobs:a},i),filename:`${t.FILENAME_PREFIX}-${Date.now()}.docx`})),this.callbacks.onExportEnded())})()},t}();P.FILENAME_PREFIX="H5P.Portfolio-Export",P.MAX_RETRIES_PER_SHOT=3,P.RETRY_TIMEOUT_MS=2500;var T=JSON.parse('{"rp":"H5PEditor.Portfolio"}');let k=function(){function t(e,i,n,o){s.addMixins(t,[g,b,m,f]),this.parent=e,this.field=i,this.params=s.extend({chapters:[]},n),this.setValue=o,this.dictionary=new u,this.fillDictionary(),this.params.chapters=this.sanitize(this.params.chapters||[]),this.chapterDOMsOrder=[...Array(this.params.chapters.length).keys()],this.changes=[],this.passReadies=!0,this.chaptersDone=[],this.chaptersPending=this.params?.chapters?.length,this.allChildrenDone=!1,this.fieldInstance=new H5PEditor.widgets[this.field.type](this.parent,this.field,this.params,this.setValue),this.fieldInstance.changes&&this.fieldInstance.changes.push((()=>{this.handleFieldChange()})),this.buildDOM(),this.$errors=this.$container.find(".h5p-errors"),this.showChapter(0),this.chapterNavigation.updateButtons(),this.setValue(this.field,this.params),this.parent.ready((()=>{this.passReadies=!1,this.listenToHeaderFooter(),this.overrideH5PCoreTitleField(),this.overrideHeaderFooter(),this.overrideCoverTitle()}))}var e=t.prototype;return e.appendTo=function(t){this.$container.appendTo(t)},e.validate=function(){return this.fieldInstance.validate()},e.remove=function(){this.$container.remove()},e.buildDOM=function(){var t=this;this.$container=H5P.jQuery("<div>",{class:"h5peditor-portfolio"}),this.chaptersDOM=document.createElement("div"),this.chaptersDOM.classList.add("h5peditor-portfolio-chapters"),this.fieldInstance.appendTo(H5P.jQuery(this.chaptersDOM)),this.chapterList=this.fieldInstance.children.find((t=>"chapters"===t?.getName())),this.mainDOM=document.createElement("div"),this.mainDOM.classList.add("h5peditor-portfolio-main");const e=document.createElement("div");e.classList.add("h5peditor-portfolio-toolbar"),this.toolBar=new y({dictionary:this.dictionary},{onClickButtonPreview:t=>{this.togglePreview({active:t})},onClickButtonExport:t=>{this.toggleExportDialog(t)},onClickButtonDeleteHidden:()=>{this.handleDeleteHiddenDialog()}}),this.toolBar.enableButton("preview"),this.toolBar.enableButton("export"),e.append(this.toolBar.getDOM()),this.mainDOM.append(e);const i=document.createElement("div");i.classList.add("h5peditor-portfolio-content"),this.chapterNavigation=new d({dictionary:this.dictionary,title:this.parent?.metadata?.title||"Portfolio",chapterList:this.chapterList,hierarchyLevelMax:g.MAX_LEVEL},{onGetChapterTitle:t=>this.getChapterTitle(t),onGetButtonCapabilities:t=>this.getButtonCapabilities(t),onAddChapter:(t,e)=>{this.addChapter(t,e)},onShowChapter:t=>{this.showChapter(t)},onMoveChapter:function(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.moveChapter(e,i,n)},onChangeHierarchy:(t,e)=>{this.changeHierarchy(t,e)},onCloneChapter:(t,e)=>{this.cloneChapter(t,e)},onDeleteChapter:t=>{this.deleteChapter(t)}}),i.append(this.chapterNavigation.getDOM()),i.append(this.chaptersDOM),this.previewOverlay=new p({dictionary:this.dictionary}),this.mainDOM.append(this.previewOverlay.getDOM()),this.spinnerAbortController=new AbortController,this.chapterChooser=new P({dictionary:this.dictionary},{onExportStarted:()=>{this.showExportSpinner()},onExportProgress:t=>{this.setSpinnerProgress(t)},onExportEnded:t=>{if(t){const e=new H5P.ConfirmationDialog({headerText:this.dictionary.get("l10n.exportFailedDialogHeader"),dialogText:t,confirmText:this.dictionary.get("l10n.ok"),hideCancel:!0,classes:["h5p-export-failed-confirmation-dialog"]}),i=()=>{window.requestAnimationFrame((()=>{this.toolBar.forceButton("export",!1)}))};e.on("confirmed",(()=>{i()})),e.on("canceled",(()=>{i()})),e.appendTo(document.body),e.show()}else this.toolBar.forceButton("export",!1);this.resetAbortController()}}),this.mainDOM.append(this.chapterChooser.getDOM()),l.attach(i),this.mainDOM.append(i),this.spinner=new E({dictionary:this.dictionary,hasAbortButton:!0},{onAborted:()=>{this.spinnerAbortController.abort()}}),this.mainDOM.appendChild(this.spinner.getDOM()),this.resetAbortController(),this.deleteHiddenDialog=new H5P.ConfirmationDialog({headerText:this.dictionary.get("l10n.deleteHiddenDialogHeader"),dialogText:this.dictionary.get("l10n.deleteHiddenDialogText"),cancelText:this.dictionary.get("l10n.deleteDialogCancel"),confirmText:this.dictionary.get("l10n.deleteDialogConfirm")}),this.deleteHiddenDialog.appendTo(document.body),this.$container.get(0).appendChild(this.mainDOM)},e.resetAbortController=function(){this.spinnerAbortController=new AbortController,this.chapterChooser.setAbortController(this.spinnerAbortController)},e.handleFieldChange=function(){this.params=this.fieldInstance.params,this.changes.forEach((t=>{t(this.params)}))},e.handleDeleteHiddenDialog=function(){this.deleteHiddenDialog.once("confirmed",(()=>{this.deleteHiddenDialog.off("canceled"),this.deleteHidden()})),this.deleteHiddenDialog.once("canceled",(()=>{this.deleteHiddenDialog.off("confirmed")})),this.deleteHiddenDialog.show()},e.deleteHidden=function(){H5P.externalDispatcher.trigger("H5PEditor.PortfolioPlaceholder:deleteHidden",{contentId:H5PEditor.contentId||1})},e.showCopySpinner=function(){this.spinner.setMessage(this.dictionary.get("l10n.cloning")),this.spinner.setProgress(""),this.spinner.show()},e.setSpinnerProgress=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.text&&("number"!=typeof t.number||"number"!=typeof t.of))return;const e=t.text||this.dictionary.get("l10n.processingChapter").replace(/@number/g,t.number).replace(/@of/g,t.of);this.spinner.setProgress(e)},e.handleTogglingHeaderFooter=function(t,e){"header"!==t&&"footer"!==t||"boolean"!=typeof e||this.fieldInstance.children.find((i=>{"chapters"===i.getName?.()&&i.forEachChild((i=>{if(!i.children)return;const n="header"===t?"displayHeader":"displayFooter",s=i.children.find((t=>t?.field?.name===n));s?.$input&&s.$input.get(0).checked!==e&&s.$input.get(0).click()}))}))},e.setChapterNavigationTitle=function(t){"string"==typeof t&&this.chapterNavigation.setTitle(t)},e.getMachineName=function(){return T.rp},t}();H5PEditor.widgets.portfolio=k}},function(t){t.O(0,[378,458,5,736],(function(){return e=5316,t(t.s=e);var e}));t.O()}]);